"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[948],{7992:function(t,e,r){r.d(e,{H:function(){return i},a:function(){return n}});var o=r(7437),a=r(2265);let l=(0,a.createContext)({}),i=t=>{let{children:e}=t,[r,i]=(0,a.useState)(),[n,s]=(0,a.useState)(),d=(0,a.useCallback)(async t=>{try{let r=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/create"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password,passwordConfirm:t.passwordConfirm})});if(r.ok){var e;let{data:t,errors:o}=await r.json();if(o)throw Error(o[0].message);i(null==t?void 0:null===(e=t.loginUser)||void 0===e?void 0:e.user),s("loggedIn")}else throw Error("Invalid login")}catch(t){throw Error("An error occurred while attempting to login.")}},[]),u=(0,a.useCallback)(async t=>{try{let e=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/login"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})});if(e.ok){let{user:t,errors:r}=await e.json();if(r)throw Error(r[0].message);return i(t),s("loggedIn"),t}throw Error("Invalid login")}catch(t){throw Error("An error occurred while attempting to login.")}},[]),c=(0,a.useCallback)(async()=>{try{let t=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/logout"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(t.ok)i(null),s("loggedOut");else throw Error("An error occurred while attempting to logout.")}catch(t){throw Error("An error occurred while attempting to logout.")}},[]);(0,a.useEffect)(()=>{let t=async()=>{try{let t=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/me"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(t.ok){let{user:e}=await t.json();i(e||null),s(e?"loggedIn":void 0)}else throw Error("An error occurred while fetching your account.")}catch(t){throw i(null),Error("An error occurred while fetching your account.")}};t()},[]);let p=(0,a.useCallback)(async t=>{try{let r=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/forgot-password"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})});if(r.ok){var e;let{data:t,errors:o}=await r.json();if(o)throw Error(o[0].message);i(null==t?void 0:null===(e=t.loginUser)||void 0===e?void 0:e.user)}else throw Error("Invalid login")}catch(t){throw Error("An error occurred while attempting to login.")}},[]),y=(0,a.useCallback)(async t=>{try{let o=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/reset-password"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t.password,passwordConfirm:t.passwordConfirm,token:t.token})});if(o.ok){var e,r;let{data:t,errors:a}=await o.json();if(a)throw Error(a[0].message);i(null==t?void 0:null===(e=t.loginUser)||void 0===e?void 0:e.user),s((null==t?void 0:null===(r=t.loginUser)||void 0===r?void 0:r.user)?"loggedIn":void 0)}else throw Error("Invalid login")}catch(t){throw Error("An error occurred while attempting to login.")}},[]);return(0,o.jsx)(l.Provider,{value:{user:r,setUser:i,login:u,logout:c,create:d,resetPassword:y,forgotPassword:p,status:n},children:e})},n=()=>(0,a.useContext)(l)},6272:function(t,e,r){r.d(e,{Z:function(){return u},j:function(){return s}});var o=r(7437),a=r(2265),l=r(7992);let i=(t,e)=>{var r,o,a;switch(e.type){case"SET_CART":return e.payload;case"MERGE_CART":{let{payload:r}=e,o=[...(null==t?void 0:t.items)||[],...(null==r?void 0:r.items)||[]].reduce((t,e)=>{var r;let o="string"==typeof e.product?e.product:null==e?void 0:null===(r=e.product)||void 0===r?void 0:r.id,a=t.findIndex(t=>{let{product:e}=t;return"string"==typeof e?e===o:(null==e?void 0:e.id)===o});return a>-1?t[a]={...t[a]}:t.push(e),t},[]);return{...t,items:o}}case"ADD_ITEM":{let{payload:a}=e,l="string"==typeof a.product?a.product:null==a?void 0:null===(r=a.product)||void 0===r?void 0:r.id,i=null==t?void 0:null===(o=t.items)||void 0===o?void 0:o.findIndex(t=>{let{product:e}=t;return"string"==typeof e?e===l:(null==e?void 0:e.id)===l}),n=[...(null==t?void 0:t.items)||[]];return -1===i&&n.push(a),"number"==typeof i&&i>-1&&(n[i]={...n[i],quantity:(a.quantity||0)>0?a.quantity:void 0}),{...t,items:n}}case"DELETE_ITEM":{let{payload:r}=e,o={...t},l=null==t?void 0:null===(a=t.items)||void 0===a?void 0:a.findIndex(t=>{let{product:e}=t;return"string"==typeof e?e===r.id:(null==e?void 0:e.id)===r.id});return"number"==typeof l&&o.items&&l>-1&&o.items.splice(l,1),o}case"CLEAR_CART":return{...t,items:[]};default:return t}},n=(0,a.createContext)({}),s=()=>(0,a.useContext)(n),d=t=>Array.isArray(t)&&t.length>0,u=t=>{let{children:e}=t,{user:r,status:s}=(0,l.a)(),[u,c]=(0,a.useReducer)(i,{items:[]}),[p,y]=(0,a.useState)({formatted:"0.00",raw:0}),h=(0,a.useRef)(!1),[v,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!h.current){h.current=!0;let t=async()=>{var t;let e=localStorage.getItem("cart"),r=JSON.parse(e||"{}");if((null==r?void 0:r.items)&&(null==r?void 0:null===(t=r.items)||void 0===t?void 0:t.length)>0){let t=await Promise.all(r.items.map(async t=>{let{product:e,quantity:r}=t,o=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/products/").concat(e)),a=await o.json();return{product:a,quantity:r}}));c({type:"SET_CART",payload:{items:t}})}else c({type:"SET_CART",payload:{items:[]}})};t()}},[]),(0,a.useEffect)(()=>{h.current&&("loggedIn"===s&&c({type:"MERGE_CART",payload:null==r?void 0:r.cart}),"loggedOut"===s&&c({type:"CLEAR_CART"}))},[r,s]),(0,a.useEffect)(()=>{var t;if(!h.current||void 0===r)return;let e={...u,items:null==u?void 0:null===(t=u.items)||void 0===t?void 0:t.map(t=>{var e;return(null==t?void 0:t.product)&&"object"==typeof(null==t?void 0:t.product)?{...t,product:null==t?void 0:null===(e=t.product)||void 0===e?void 0:e.id,quantity:"number"==typeof(null==t?void 0:t.quantity)?null==t?void 0:t.quantity:0}:null}).filter(Boolean)};if(r)try{let t=async()=>{let t=await fetch("".concat("https://happy-hearts.payloadcms.app","/api/users/").concat(r.id),{credentials:"include",method:"PATCH",body:JSON.stringify({cart:e}),headers:{"Content-Type":"application/json"}});t.ok&&localStorage.setItem("cart","[]")};t()}catch(t){console.error("Error while syncing cart to Payload.")}else localStorage.setItem("cart",JSON.stringify(e));f(!0)},[r,u]);let m=(0,a.useCallback)(t=>{let e=!1,{items:r}=u||{};return Array.isArray(r)&&r.length>0&&(e=!!r.find(e=>{let{product:r}=e;return"string"==typeof r?r===t.id:(null==r?void 0:r.id)===t.id})),e},[u]),g=(0,a.useCallback)(t=>{c({type:"ADD_ITEM",payload:t})},[]),w=(0,a.useCallback)(t=>{c({type:"DELETE_ITEM",payload:t})},[]),E=(0,a.useCallback)(()=>{c({type:"CLEAR_CART"})},[]);return(0,a.useEffect)(()=>{var t;if(!h)return;let e=(null==u?void 0:null===(t=u.items)||void 0===t?void 0:t.reduce((t,e)=>{var r,o,a,l;return t+("object"==typeof e.product?(null===(a=JSON.parse((null==e?void 0:null===(l=e.product)||void 0===l?void 0:l.priceJSON)||"{}"))||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:r.unit_amount)*("number"==typeof(null==e?void 0:e.quantity)?null==e?void 0:e.quantity:0):0)},0))||0;y({formatted:(e/100).toLocaleString("en-US",{style:"currency",currency:"USD"}),raw:e})},[u,h]),(0,o.jsx)(n.Provider,{value:{cart:u,addItemToCart:g,deleteItemFromCart:w,cartIsEmpty:v&&!d(null==u?void 0:u.items),clearCart:E,isProductInCart:m,cartTotal:p,hasInitializedCart:v},children:e&&e})}}}]);