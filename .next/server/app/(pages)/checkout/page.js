(()=>{var e={};e.id=925,e.ids=[925],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2021:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>d,pages:()=>p,routeModule:()=>h,tree:()=>u});var s=r(73137),a=r(54647),o=r(4183),n=r.n(o),i=r(71775),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let l=s.AppPageRouteModule,u=["",{children:["(pages)",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,28449)),"/Users/lorenzoparisi/Documents/GitHub/happyhappy/src/app/(pages)/checkout/page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(r.bind(r,45653)),"/Users/lorenzoparisi/Documents/GitHub/happyhappy/src/app/(pages)/not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,82645)),"/Users/lorenzoparisi/Documents/GitHub/happyhappy/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,51918,23)),"next/dist/client/components/not-found-error"]}],p=["/Users/lorenzoparisi/Documents/GitHub/happyhappy/src/app/(pages)/checkout/page.tsx"],d="/(pages)/checkout/page",m={require:r,loadChunk:()=>Promise.resolve()},h=new l({definition:{kind:a.x.APP_PAGE,page:"/(pages)/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},30358:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,42796,23)),Promise.resolve().then(r.bind(r,30083))},30083:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CheckoutPage:()=>q});var s=r(60080),a=r(9885),o=r.n(a),n=r(65140),i=r(14041),c=r(11440),l=r.n(c),u=r(57114),p=r(39496),d=r(73185),m=r(8693),h=r(17644),_=r(9876),x=r(67705),g=r.n(x),y=r(42655),j=r(59974),f=r(32366),k=r.n(f);let b=()=>{let e=(0,n.MD)(),t=(0,n.lq)(),[r,i]=o().useState(null),[c,l]=o().useState(!1),d=(0,u.useRouter)(),{cart:m,cartTotal:_}=(0,h.j)(),x=(0,a.useCallback)(async r=>{r.preventDefault(),l(!0);try{let{error:r,paymentIntent:s}=await e?.confirmPayment({elements:t,redirect:"if_required",confirmParams:{return_url:"https://happy-hearts.payloadcms.app/order-confirmation"}});if(r&&(i(r.message),l(!1)),s)try{let e=await fetch("https://happy-hearts.payloadcms.app/api/orders",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({total:_.raw,stripePaymentIntentID:s.id,items:(m?.items||[])?.map(({product:e,quantity:t})=>({product:"string"==typeof e?e:e.id,quantity:t,price:"object"==typeof e?j.priceFromJSON(e.priceJSON,1,!0):void 0}))})});if(!e.ok)throw Error(e.statusText||"Something went wrong.");let{error:t,doc:r}=await e.json();if(t)throw Error(t);d.push(`/order-confirmation?order_id=${r.id}`)}catch(e){console.error(e.message),d.push(`/order-confirmation?error=${encodeURIComponent(e.message)}`)}}catch(t){let e=t instanceof Error?t.message:"Something went wrong.";i(`Error while submitting payment: ${e}`),l(!1)}},[e,t,d,m,_]);return(0,s.jsxs)("form",{onSubmit:x,className:k().form,children:[r&&s.jsx(y.v,{error:r}),s.jsx(n.Hn,{}),(0,s.jsxs)("div",{className:k().actions,children:[s.jsx(p.Button,{label:"Back to cart",href:"/cart",appearance:"secondary"}),s.jsx(p.Button,{label:c?"Loading...":"Checkout",type:"submit",appearance:"primary",disabled:!e||c})]})]})};var v=r(88995),P=r(20096),C=r.n(P);let w=({product:e,title:t,metaImage:r,quantity:a,index:o})=>(0,s.jsxs)("li",{className:C().item,children:[(0,s.jsxs)(l(),{href:`/products/${e.slug}`,className:C().mediaWrapper,children:[!r&&s.jsx("span",{children:"No image"}),r&&"string"!=typeof r&&s.jsx(v.p,{className:C().media,imgClassName:C().image,resource:r,fill:!0})]}),(0,s.jsxs)("div",{className:C().itemDetails,children:[(0,s.jsxs)("div",{className:C().titleWrapper,children:[s.jsx("h6",{children:t}),s.jsx(j.Price,{product:e,button:!1})]}),(0,s.jsxs)("p",{className:C().quantity,children:["x",a]})]}),s.jsx("div",{className:C().subtotal,children:s.jsx(j.Price,{product:e,button:!1,quantity:a})})]},o);var N=r(12815),I=r.n(N);let S=(0,i.J)(""),q=e=>{let{settings:{productsPage:t}}=e,{user:r}=(0,m.a)(),i=(0,u.useRouter)(),[c,x]=o().useState(null),[y,j]=o().useState(),f=o().useRef(!1),{theme:k}=(0,_.F)(),{cart:v,cartIsEmpty:P,cartTotal:C}=(0,h.j)();return((0,a.useEffect)(()=>{null!==r&&P&&i.push("/cart")},[i,r,P]),(0,a.useEffect)(()=>{if(r&&v&&!1===f.current){f.current=!0;let e=async()=>{try{let e=await fetch("https://happy-hearts.payloadcms.app/api/create-payment-intent",{method:"POST",credentials:"include"}),t=await e.json();t.error?x(t.error):t.client_secret&&(x(null),j(t.client_secret))}catch(e){x("Something went wrong.")}};e()}},[v,r]),r&&S)?(0,s.jsxs)(a.Fragment,{children:[P&&(0,s.jsxs)("div",{children:["Your ",s.jsx(l(),{href:"/cart",children:"cart"})," is empty.","object"==typeof t&&t?.slug&&(0,s.jsxs)(a.Fragment,{children:[" ",s.jsx(l(),{href:`/${t.slug}`,children:"Continue shopping?"})]})]}),!P&&(0,s.jsxs)("div",{className:I().items,children:[(0,s.jsxs)("div",{className:I().header,children:[s.jsx("p",{children:"Products"}),(0,s.jsxs)("div",{className:I().headerItemDetails,children:[s.jsx("p",{}),s.jsx("p",{className:I().quantity,children:"Quantity"})]}),s.jsx("p",{className:I().subtotal,children:"Subtotal"})]}),(0,s.jsxs)("ul",{children:[v?.items?.map((e,t)=>{if("object"==typeof e.product){let{quantity:r,product:o,product:{title:n,meta:i}}=e;if(!r)return null;let c=i?.image;return s.jsx(a.Fragment,{children:s.jsx(w,{product:o,title:n,metaImage:c,quantity:r,index:t})},t)}return null}),(0,s.jsxs)("div",{className:I().orderTotal,children:[s.jsx("p",{children:"Order Total"}),s.jsx("p",{children:C.formatted})]})]})]}),!y&&!c&&s.jsx("div",{className:I().loading,children:s.jsx(d.h,{number:2})}),!y&&c&&(0,s.jsxs)("div",{className:I().error,children:[s.jsx("p",{children:`Error: ${c}`}),s.jsx(p.Button,{label:"Back to cart",href:"/cart",appearance:"secondary"})]}),y&&(0,s.jsxs)(a.Fragment,{children:[s.jsx("h3",{className:I().payment,children:"Payment Details"}),c&&s.jsx("p",{children:`Error: ${c}`}),s.jsx(n.eK,{stripe:S,options:{clientSecret:y,appearance:{theme:"stripe",variables:{colorText:"dark"===k?g().colors.base0:g().colors.base1000,fontSizeBase:"16px",fontWeightNormal:"500",fontWeightBold:"600",colorBackground:"dark"===k?g().colors.base850:g().colors.base0,fontFamily:"Inter, sans-serif",colorTextPlaceholder:g().colors.base500,colorIcon:"dark"===k?g().colors.base0:g().colors.base1000,borderRadius:"0px",colorDanger:g().colors.error500,colorDangerText:g().colors.error500}}},children:s.jsx(b,{})})]})]}):null}},73185:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var s=r(60080);r(9885);var a=r(72215),o=r.n(a);let n=e=>{let t=Array.from(Array(e.number||1).keys());return s.jsx("div",{className:o().loading,children:t.map((e,t)=>s.jsx("div",{className:o().shimmer},t))})}},88995:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var s=r(60080),a=r(9885),o=r(94011),n=r(70966);let i=e=>{let{className:t,resource:r,htmlElement:i="div"}=e,c="string"!=typeof r&&r?.mimeType?.includes("video"),l=i||a.Fragment;return s.jsx(l,{...null!==i?{className:t}:{},children:c?s.jsx(n.Video,{...e}):s.jsx(o.Image,{...e})})}},42655:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(60080);r(9885);var a=r(8514),o=r.n(a);let n=({message:e,error:t,success:r,warning:a,className:n})=>{let i=e||t||r||a;return i?s.jsx("div",{className:[o().message,n,t&&o().error,r&&o().success,a&&o().warning,!t&&!r&&!a&&o().default].filter(Boolean).join(" "),children:i}):null}},32366:e=>{e.exports={form:"CheckoutForm_form__UhcpU",actions:"CheckoutForm_actions__dvYjH"},e.exports.__checksum="df58128d7cfa"},20096:e=>{e.exports={item:"CheckoutItem_item__cxCFA",mediaWrapper:"CheckoutItem_mediaWrapper__nq8fa",media:"CheckoutItem_media__WFGoI",image:"CheckoutItem_image__zkSL6",itemDetails:"CheckoutItem_itemDetails__J6Tve",titleWrapper:"CheckoutItem_titleWrapper__LWhvI",quantity:"CheckoutItem_quantity__dlFv7",subtotal:"CheckoutItem_subtotal__8JJtA"},e.exports.__checksum="2cae2051e139"},12815:e=>{e.exports={items:"CheckoutPage_items__BRLyq",header:"CheckoutPage_header__uEemM",headerItemDetails:"CheckoutPage_headerItemDetails__OwApE",headersubtotal:"CheckoutPage_headersubtotal__d2wQg",subtotal:"CheckoutPage_subtotal__sG0ES",orderTotal:"CheckoutPage_orderTotal__c5Lxw",payment:"CheckoutPage_payment__mXReJ",loading:"CheckoutPage_loading__EpVBZ",error:"CheckoutPage_error__NyGE5"},e.exports.__checksum="b08336594c5b"},44900:e=>{e.exports={checkout:"checkout_checkout__iVwRz"},e.exports.__checksum="5f91ae5c93ce"},72215:e=>{e.exports={loading:"LoadingShimmer_loading__sK7Rg",shimmer:"LoadingShimmer_shimmer__YtrFI"},e.exports.__checksum="eba6cbe2403e"},8514:e=>{e.exports={message:"Message_message__z1tdG",default:"Message_default__RDDb4",warning:"Message_warning__FT9n8",error:"Message_error__WX2fA",success:"Message_success__Cnnxv"},e.exports.__checksum="21e7800cf184"},28449:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>_,metadata:()=>x});var s=r(48144);r(53830);var a=r(28996),o=r(53205),n=r(1978),i=r(62208),c=r(17536);let l=(0,c.createProxy)(String.raw`/Users/lorenzoparisi/Documents/GitHub/happyhappy/src/app/(pages)/checkout/CheckoutPage/index.tsx`),{__esModule:u,$$typeof:p}=l;l.default;let d=l.CheckoutPage;var m=r(44900),h=r.n(m);async function _(){await (0,n.S)({nullUserRedirect:`/login?error=${encodeURIComponent("You must be logged in to checkout.")}&redirect=${encodeURIComponent("/checkout")}`});let e=null;try{e=await (0,a.wv)()}catch(e){console.error(e)}return s.jsx("div",{className:h().checkout,children:s.jsx(o.T,{children:s.jsx(d,{settings:e})})})}let x={title:"Account",description:"Create an account or log in to your existing account.",openGraph:(0,i.T)({title:"Account",url:"/account"})}},1978:(e,t,r)=>{"use strict";r.d(t,{S:()=>o});var s=r(59859),a=r(6465);let o=async e=>{let{nullUserRedirect:t,validUserRedirect:r}=e||{},o=(0,s.cookies)(),n=o.get("payload-token")?.value,i=await fetch("https://happy-hearts.payloadcms.app/api/users/me",{headers:{Authorization:`JWT ${n}`}}),{user:c}=await i.json();return r&&i.ok&&c&&(0,a.redirect)(r),!t||i.ok&&c||(0,a.redirect)(t),{user:c,token:n}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4650,2560,7190,3497,9859,6465,8030,1224,8667,6965,12,9974],()=>r(2021));module.exports=s})();